---

- name: Check nginx is running
  command: curl --output /dev/null --silent --head --fail http://localhost
  args:
    warn: no # recommends to use get_url when get_url fails in this case

- name: Create base directory
  file:
    path: "{{ nginx_check_directory_path }}"
    state: directory

- name: Create file to check
  file:
    path: "{{ nginx_check_file_path }}"
    state: touch
  notify:
    - Restart Nginx

- name: Force Nginx restart
  meta: flush_handlers

- name: Create temporary file to place nginx test output
  tempfile:
    state: file
  register: tempory_file

- name: Check file exists
  get_url:
    url: "http://localhost/{{ nginx_check_file_path }}"
    dest: "{{ tempory_file.path }}"
